# Terraform Gatekeeper Configuration
# Defines protected resource types and security rules

protected_resources:
  # Critical infrastructure resources that should never be deleted
  aws_db_instance: true
  aws_rds_cluster: true
  aws_kms_key: true
  aws_s3_bucket: true
  aws_security_group: true
  aws_vpc: true
  aws_subnet: true
  aws_route_table: true
  aws_internet_gateway: true
  aws_nat_gateway: true
  aws_eks_cluster: true
  aws_elb_application_load_balancer: true
  
  # Optional: Add more protected resources as needed
  # aws_iam_policy: false
  # aws_iam_role: false
  # aws_iam_user: false

security_rules:
  # Security group rules
  allow_wildcard_ingress: false
  allow_wildcard_egress: false
  
  # Additional security rules can be added here
  # require_encryption_at_rest: true
  # require_encryption_in_transit: true

# Time-based rules
time_based_rules:
  # Upgrade warnings to critical on weekends or Friday after 3 PM
  upgrade_friday_afternoon: true
  upgrade_weekends: true
  
  # Custom time windows (24-hour format)
  # critical_time_windows:
  #   - start: "15:00"
  #     end: "23:59"
  #     days: [4]  # Friday

# Drift detection rules
drift_detection:
  # Enable drift comparison
  enabled: true
  
  # Resources to check for drift
  check_resources:
    - aws_security_group
    - aws_s3_bucket
  
  # Drift tolerance level
  tolerance_level: "strict"  # strict, moderate, lenient

# AI Integration Settings
ai_integration:
  # Enable AI analysis
  enabled: true
  
  # LLM model to use (OpenAI, Anthropic, etc.)
  model: "gpt-4"
  
  # API key configuration (not recommended to store here in production)
  # api_key: "${API_KEY}"
  
  # Prompt templates
  prompts:
    mismatch_detection: |
      Analyze the following Terraform plan changes against the user's stated intent.
      
      User's Commit Message (Intent):
      {commit_message}
      
      Terraform Plan Changes (Reality):
      {plan_changes}
      
      Question: Does the user's stated intent match the actual changes being made?
      If there's a significant mismatch (e.g., user says they're updating tags but plan shows database deletion),
      respond with "MISMATCH" followed by a brief explanation.
      If the intent matches the changes, respond with "MATCH".
    
    risk_summary: |
      Generate a concise 2-line summary of the security risks found in this Terraform plan.
      Focus on the most critical risks that should be immediately addressed.
      
      Plan changes:
      {plan_changes}
      
      Summary:
    
    recommendation: |
      Based on the Terraform plan changes and identified risks, provide 1-3 specific recommendations
      for improving the security posture of this infrastructure change.
      
      Changes:
      {plan_changes}
      
      Risks identified:
      {risks}
      
      Recommendations:

# Notification settings
notifications:
  # Send notifications to Slack
  slack:
    enabled: false
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#security-alerts"
  
  # Email notifications
  email:
    enabled: false
    smtp_server: "${SMTP_SERVER}"
    smtp_port: "${SMTP_PORT}"
    username: "${SMTP_USERNAME}"
    password: "${SMTP_PASSWORD}"
    recipients:
      - "security@company.com"

# Logging settings
logging:
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR
  file: "gatekeeper.log"
  max_size_mb: 10
  backup_count: 5